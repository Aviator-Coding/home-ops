---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/gateway.networking.k8s.io/httproute_v1.json
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: https-redirect
  namespace: ai-system
  annotations:
    external-dns.alpha.kubernetes.io/controller: none
spec:
  parentRefs:
    - name: agentgateway
      namespace: ai-system
      sectionName: http
  rules:
    - filters:
        - type: RequestRedirect
          requestRedirect:
            scheme: https
            statusCode: 301
---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/gateway.networking.k8s.io/httproute_v1.json
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: llm-routes
  namespace: ai-system
spec:
  parentRefs:
    - name: agentgateway
      namespace: ai-system
      sectionName: https
  rules:
    # OpenAI route
    - matches:
        - path:
            type: PathPrefix
            value: /openai
      filters:
        - type: URLRewrite
          urlRewrite:
            path:
              type: ReplaceFullPath
              replaceFullPath: /v1/chat/completions
      backendRefs:
        - name: openai
          group: gateway.kgateway.dev
          kind: Backend
    # Anthropic route
    - matches:
        - path:
            type: PathPrefix
            value: /anthropic
      backendRefs:
        - name: anthropic
          group: gateway.kgateway.dev
          kind: Backend
    # Gemini route
    - matches:
        - path:
            type: PathPrefix
            value: /gemini
      backendRefs:
        - name: gemini
          group: gateway.kgateway.dev
          kind: Backend
    # Groq route
    - matches:
        - path:
            type: PathPrefix
            value: /groq
      filters:
        - type: URLRewrite
          urlRewrite:
            path:
              type: ReplaceFullPath
              replaceFullPath: /openai/v1/chat/completions
      backendRefs:
        - name: groq
          group: gateway.kgateway.dev
          kind: Backend
    # Deepseek route
    - matches:
        - path:
            type: PathPrefix
            value: /deepseek
      filters:
        - type: URLRewrite
          urlRewrite:
            path:
              type: ReplaceFullPath
              replaceFullPath: /v1/chat/completions
      backendRefs:
        - name: deepseek
          group: gateway.kgateway.dev
          kind: Backend
    # xAI route
    - matches:
        - path:
            type: PathPrefix
            value: /xai
      filters:
        - type: URLRewrite
          urlRewrite:
            path:
              type: ReplaceFullPath
              replaceFullPath: /v1/chat/completions
      backendRefs:
        - name: xai
          group: gateway.kgateway.dev
          kind: Backend
    # Mistral route
    - matches:
        - path:
            type: PathPrefix
            value: /mistral
      filters:
        - type: URLRewrite
          urlRewrite:
            path:
              type: ReplaceFullPath
              replaceFullPath: /v1/chat/completions
      backendRefs:
        - name: mistral
          group: gateway.kgateway.dev
          kind: Backend
    # Together.ai route
    - matches:
        - path:
            type: PathPrefix
            value: /togetherai
      filters:
        - type: URLRewrite
          urlRewrite:
            path:
              type: ReplaceFullPath
              replaceFullPath: /v1/chat/completions
      backendRefs:
        - name: togetherai
          group: gateway.kgateway.dev
          kind: Backend
    # Failover route (load balanced with automatic failover)
    - matches:
        - path:
            type: PathPrefix
            value: /failover
      backendRefs:
        - name: llm-failover
          group: gateway.kgateway.dev
          kind: Backend
    # LiteLLM proxy route for backward compatibility
    - matches:
        - path:
            type: PathPrefix
            value: /v1
      backendRefs:
        - name: litellm-proxy
          group: gateway.kgateway.dev
          kind: Backend
---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/gateway.networking.k8s.io/httproute_v1.json
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: health-route
  namespace: ai-system
spec:
  parentRefs:
    - name: agentgateway
      namespace: ai-system
      sectionName: https
  rules:
    - matches:
        - path:
            type: Exact
            value: /healthz
      backendRefs:
        - name: litellm-proxy
          group: gateway.kgateway.dev
          kind: Backend
